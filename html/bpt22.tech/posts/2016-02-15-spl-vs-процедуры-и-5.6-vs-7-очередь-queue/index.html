<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Evgen Pyanykh"><meta name=description content="Рассмотрим структуры данных из стандартной библиотеки php (SPL) и процедурный подход с массивами. И замеряем скорость выполнения на разных версиях PHP, а именно на 5.6 и 7. Сегодняшняя тема: «структура Очередь».
Очередь — абстрактный тип данных с дисциплиной доступа к элементам «первый пришёл — первый вышел» (FIFO, First In — First Out). Добавление элемента (принято обозначать словом enqueue — поставить в очередь) возможно лишь в конец очереди, выборка — только из начала очереди (что принято называть словом dequeue — убрать из очереди), при этом выбранный элемент из очереди удаляется."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="SPL VS процедуры и 5.6 VS 7 очередь (queue)"><meta name=twitter:description content="Рассмотрим структуры данных из стандартной библиотеки php (SPL) и процедурный подход с массивами. И замеряем скорость выполнения на разных версиях PHP, а именно на 5.6 и 7. Сегодняшняя тема: «структура Очередь».
Очередь — абстрактный тип данных с дисциплиной доступа к элементам «первый пришёл — первый вышел» (FIFO, First In — First Out). Добавление элемента (принято обозначать словом enqueue — поставить в очередь) возможно лишь в конец очереди, выборка — только из начала очереди (что принято называть словом dequeue — убрать из очереди), при этом выбранный элемент из очереди удаляется."><meta property="og:title" content="SPL VS процедуры и 5.6 VS 7 очередь (queue)"><meta property="og:description" content="Рассмотрим структуры данных из стандартной библиотеки php (SPL) и процедурный подход с массивами. И замеряем скорость выполнения на разных версиях PHP, а именно на 5.6 и 7. Сегодняшняя тема: «структура Очередь».
Очередь — абстрактный тип данных с дисциплиной доступа к элементам «первый пришёл — первый вышел» (FIFO, First In — First Out). Добавление элемента (принято обозначать словом enqueue — поставить в очередь) возможно лишь в конец очереди, выборка — только из начала очереди (что принято называть словом dequeue — убрать из очереди), при этом выбранный элемент из очереди удаляется."><meta property="og:type" content="article"><meta property="og:url" content="//bpt22.tech/posts/2016-02-15-spl-vs-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D1%8B-%D0%B8-5.6-vs-7-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D1%8C-queue/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-02-15T00:00:00+00:00"><meta property="article:modified_time" content="2016-02-15T00:00:00+00:00"><title>SPL VS процедуры и 5.6 VS 7 очередь (queue) · Evgen Pyanykh</title><link rel=canonical href=//bpt22.tech/posts/2016-02-15-spl-vs-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D1%8B-%D0%B8-5.6-vs-7-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D1%8C-queue/><link rel=preload href="//bpt22.tech/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=//bpt22.tech/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=//bpt22.tech/img/little_w.png sizes=32x32><link rel=icon type=image/png href=//bpt22.tech/img/little_w.png sizes=16x16><link rel=apple-touch-icon href=//bpt22.tech/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=//bpt22.tech/images/apple-touch-icon.png><meta name=generator content="Hugo 0.97.3"></head><body class="preload-transitions colorscheme-light"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=//bpt22.tech>Evgen Pyanykh</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=//bpt22.tech/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/skills/>Skills</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/contact/>Contact me</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/license/>License</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=//bpt22.tech/posts/2016-02-15-spl-vs-%D0%BF%D1%80%D0%BE%D1%86%D0%B5%D0%B4%D1%83%D1%80%D1%8B-%D0%B8-5.6-vs-7-%D0%BE%D1%87%D0%B5%D1%80%D0%B5%D0%B4%D1%8C-queue/>SPL VS процедуры и 5.6 VS 7 очередь (queue)</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2016-02-15T00:00:00Z>2016-02-15</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
2-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=//bpt22.tech/categories/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/>ПРОГРАММИРОВАНИЕ</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=//bpt22.tech/tags/5.6/>5.6</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/7/>7</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/php/>PHP</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/queue/>QUEUE</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/spl/>SPL</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/test/>TEST</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/%D1%81%D0%BA%D0%BE%D1%80%D0%BE%D1%81%D1%82%D1%8C/>СКОРОСТЬ</a></span></div></div></header><div><p><img src=//bpt22.tech/img/php-spl/red.png alt></p><p>Рассмотрим структуры данных из стандартной библиотеки php (SPL) и процедурный подход с массивами. И замеряем скорость выполнения на разных версиях PHP, а именно на 5.6 и 7. Сегодняшняя тема: «структура Очередь».</p><p>Очередь — абстрактный тип данных с дисциплиной доступа к элементам «первый пришёл — первый вышел» (FIFO, First In — First Out). Добавление элемента (принято обозначать словом enqueue — поставить в очередь) возможно лишь в конец очереди, выборка — только из начала очереди (что принято называть словом dequeue — убрать из очереди), при этом выбранный элемент из очереди удаляется.</p><p>Результат если лень читать:</p><p><img src=//bpt22.tech/img/php-spl/queue5.png alt>
<img src=//bpt22.tech/img/php-spl/queue7.png alt></p><h3 id=процедурный-подход>Процедурный подход
<a class=heading-link href=#%d0%bf%d1%80%d0%be%d1%86%d0%b5%d0%b4%d1%83%d1%80%d0%bd%d1%8b%d0%b9-%d0%bf%d0%be%d0%b4%d1%85%d0%be%d0%b4><i class="fa fa-link" aria-hidden=true></i></a></h3><h4 id=запись>Запись:
<a class=heading-link href=#%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8c><i class="fa fa-link" aria-hidden=true></i></a></h4><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>&lt;?
</span></span><span style=display:flex><span>$repeatSize = <span style=color:#ff0;font-weight:700>3000000</span>;
</span></span><span style=display:flex><span>$stack = [];
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>for</span> ($i=<span style=color:#ff0;font-weight:700>1</span>; $i&lt;$repeatSize; $i++){
</span></span><span style=display:flex><span>    array_push($stack, $i);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><table><thead><tr><th style=text-align:center>VERSION</th><th style=text-align:center>TIME</th><th style=text-align:center>MEMORY</th><th style=text-align:center>MEMORY PEAK</th></tr></thead><tbody><tr><td style=text-align:center>5.6</td><td style=text-align:center>1.0570449829102</td><td style=text-align:center>442236928</td><td style=text-align:center>442236928</td></tr><tr><td style=text-align:center>7</td><td style=text-align:center>0.35105609893799</td><td style=text-align:center>136318976</td><td style=text-align:center>136318976</td></tr></tbody></table><h4 id=чтение>Чтение:
<a class=heading-link href=#%d1%87%d1%82%d0%b5%d0%bd%d0%b8%d0%b5><i class="fa fa-link" aria-hidden=true></i></a></h4><p>Для чтения использую each и unset вместо array_shift. array_shift после извлечения постоянно пересчитывает индексы элементов, и при количестве 3000000 элементов скрипт очень долго выполняется.</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>&lt;?
</span></span><span style=display:flex><span>$repeatSize = <span style=color:#ff0;font-weight:700>3000000</span>;
</span></span><span style=display:flex><span>$stack = [];
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>for</span> ($i=<span style=color:#ff0;font-weight:700>1</span>; $i&lt;$repeatSize; $i++){
</span></span><span style=display:flex><span>    array_push($stack, $i);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#007f7f>//start timer
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>reset($stack);
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>while</span>(<span style=color:#fff;font-weight:700>list</span>($key, $value) = each($stack)){
</span></span><span style=display:flex><span>    unset($stack[$key]);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><table><thead><tr><th style=text-align:center>VERSION</th><th style=text-align:center>TIME</th><th style=text-align:center>MEMORY</th><th style=text-align:center>MEMORY PEAK</th></tr></thead><tbody><tr><td style=text-align:center>5.6</td><td style=text-align:center>1.8466589450836</td><td style=text-align:center>34865152</td><td style=text-align:center>442236928</td></tr><tr><td style=text-align:center>7</td><td style=text-align:center>0.92776489257812</td><td style=text-align:center>136318976</td><td style=text-align:center>136318976</td></tr></tbody></table><h3 id=spl>SPL
<a class=heading-link href=#spl><i class="fa fa-link" aria-hidden=true></i></a></h3><h4 id=запись-1>Запись:
<a class=heading-link href=#%d0%b7%d0%b0%d0%bf%d0%b8%d1%81%d1%8c-1><i class="fa fa-link" aria-hidden=true></i></a></h4><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>&lt;?
</span></span><span style=display:flex><span>$repeatSize = <span style=color:#ff0;font-weight:700>3000000</span>;
</span></span><span style=display:flex><span>$stack = <span style=color:#fff;font-weight:700>new</span> SplQueue();
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>for</span> ($i=<span style=color:#ff0;font-weight:700>1</span>; $i&lt;$repeatSize; $i++){
</span></span><span style=display:flex><span>    $stack-&gt;<span style=color:#007f7f>enqueue</span>($i);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><table><thead><tr><th style=text-align:center>VERSION</th><th style=text-align:center>TIME</th><th style=text-align:center>MEMORY</th><th style=text-align:center>MEMORY PEAK</th></tr></thead><tbody><tr><td style=text-align:center>5.6</td><td style=text-align:center>0.79875707626343</td><td style=text-align:center>288358400</td><td style=text-align:center>288358400</td></tr><tr><td style=text-align:center>7</td><td style=text-align:center>0.39700293540955</td><td style=text-align:center>121634816</td><td style=text-align:center>121634816</td></tr></tbody></table><h4 id=чтение-1>Чтение
<a class=heading-link href=#%d1%87%d1%82%d0%b5%d0%bd%d0%b8%d0%b5-1><i class="fa fa-link" aria-hidden=true></i></a></h4><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>&lt;?
</span></span><span style=display:flex><span>$repeatSize = <span style=color:#ff0;font-weight:700>3000000</span>;
</span></span><span style=display:flex><span>$stack = <span style=color:#fff;font-weight:700>new</span> SplQueue();
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>for</span> ($i=<span style=color:#ff0;font-weight:700>1</span>; $i&lt;$repeatSize; $i++){
</span></span><span style=display:flex><span>    $stack-&gt;<span style=color:#007f7f>enqueue</span>($i);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#007f7f>//start timer
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#fff;font-weight:700>while</span> ($stack-&gt;<span style=color:#007f7f>dequeue</span>());
</span></span><span style=display:flex><span>} <span style=color:#fff;font-weight:700>catch</span> (RuntimeException $e) {}
</span></span></code></pre></div><table><thead><tr><th style=text-align:center>VERSION</th><th style=text-align:center>TIME</th><th style=text-align:center>MEMORY</th><th style=text-align:center>MEMORY PEAK</th></tr></thead><tbody><tr><td style=text-align:center>5.6</td><td style=text-align:center>0.58935618400574</td><td style=text-align:center>1048576</td><td style=text-align:center>288358400</td></tr><tr><td style=text-align:center>7</td><td style=text-align:center>0.19628190994263</td><td style=text-align:center>121634816</td><td style=text-align:center>121634816</td></tr></tbody></table></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2022
Evgen Pyanykh
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=//bpt22.tech/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script></body></html>
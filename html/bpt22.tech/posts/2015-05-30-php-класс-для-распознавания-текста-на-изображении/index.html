<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta name=author content="Evgen Pyanykh"><meta name=description content="Для одного из проектов было необходимо распознать текст на изображении. Были варианты использования Tesseract, но была вероятность использования простого хостинга где не будет возможности установить дополнительный софт. Проанализировав доступные средства на GitHub нашел несколько реализаций, но они были на мой взгляд, то слишком сложные, то не простые для быстрой интеграции. В общем свой велосипед ближе и милей.
Класс поддерживает только текст написанный на монотонном фоне, без перемешивания строк. Такие изображения он не обработает:"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="PHP класс для распознавания текста на изображении"><meta name=twitter:description content="Для одного из проектов было необходимо распознать текст на изображении. Были варианты использования Tesseract, но была вероятность использования простого хостинга где не будет возможности установить дополнительный софт. Проанализировав доступные средства на GitHub нашел несколько реализаций, но они были на мой взгляд, то слишком сложные, то не простые для быстрой интеграции. В общем свой велосипед ближе и милей.
Класс поддерживает только текст написанный на монотонном фоне, без перемешивания строк. Такие изображения он не обработает:"><meta property="og:title" content="PHP класс для распознавания текста на изображении"><meta property="og:description" content="Для одного из проектов было необходимо распознать текст на изображении. Были варианты использования Tesseract, но была вероятность использования простого хостинга где не будет возможности установить дополнительный софт. Проанализировав доступные средства на GitHub нашел несколько реализаций, но они были на мой взгляд, то слишком сложные, то не простые для быстрой интеграции. В общем свой велосипед ближе и милей.
Класс поддерживает только текст написанный на монотонном фоне, без перемешивания строк. Такие изображения он не обработает:"><meta property="og:type" content="article"><meta property="og:url" content="//bpt22.tech/posts/2015-05-30-php-%D0%BA%D0%BB%D0%B0%D1%81%D1%81-%D0%B4%D0%BB%D1%8F-%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%B7%D0%BD%D0%B0%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0-%D0%BD%D0%B0-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-05-30T00:00:00+00:00"><meta property="article:modified_time" content="2015-05-30T00:00:00+00:00"><title>PHP класс для распознавания текста на изображении · Evgen Pyanykh</title><link rel=canonical href=//bpt22.tech/posts/2015-05-30-php-%D0%BA%D0%BB%D0%B0%D1%81%D1%81-%D0%B4%D0%BB%D1%8F-%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%B7%D0%BD%D0%B0%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0-%D0%BD%D0%B0-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8/><link rel=preload href="//bpt22.tech/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=//bpt22.tech/css/coder.min.d9fddbffe6f27e69985dc5fe0471cdb0e57fbf4775714bc3d847accb08f4a1f6.css integrity="sha256-2f3b/+byfmmYXcX+BHHNsOV/v0d1cUvD2Eesywj0ofY=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=//bpt22.tech/img/little_w.png sizes=32x32><link rel=icon type=image/png href=//bpt22.tech/img/little_w.png sizes=16x16><link rel=apple-touch-icon href=//bpt22.tech/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=//bpt22.tech/images/apple-touch-icon.png><meta name=generator content="Hugo 0.97.3"></head><body class="preload-transitions colorscheme-light"><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=//bpt22.tech>Evgen Pyanykh</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=//bpt22.tech/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/skills/>Skills</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/contact/>Contact me</a></li><li class=navigation-item><a class=navigation-link href=//bpt22.tech/license/>License</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=//bpt22.tech/posts/2015-05-30-php-%D0%BA%D0%BB%D0%B0%D1%81%D1%81-%D0%B4%D0%BB%D1%8F-%D1%80%D0%B0%D1%81%D0%BF%D0%BE%D0%B7%D0%BD%D0%B0%D0%B2%D0%B0%D0%BD%D0%B8%D1%8F-%D1%82%D0%B5%D0%BA%D1%81%D1%82%D0%B0-%D0%BD%D0%B0-%D0%B8%D0%B7%D0%BE%D0%B1%D1%80%D0%B0%D0%B6%D0%B5%D0%BD%D0%B8%D0%B8/>PHP класс для распознавания текста на изображении</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2015-05-30T00:00:00Z>2015-05-30</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i>
<a href=//bpt22.tech/categories/%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5/>ПРОГРАММИРОВАНИЕ</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=//bpt22.tech/tags/gd/>GD</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/gd2/>GD2</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/ocr/>OCR</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/php/>PHP</a></span>
<span class=separator>•</span>
<span class=tag><a href=//bpt22.tech/tags/%D0%B2%D0%B5%D0%BB%D0%BE%D1%81%D0%B8%D0%BF%D0%B5%D0%B4/>ВЕЛОСИПЕД</a></span></div></div></header><div><p><img src=//bpt22.tech/img/ocr.png alt=ocr></p><p>Для одного из проектов было необходимо распознать текст на изображении. Были варианты использования Tesseract, но была вероятность использования простого хостинга где не будет возможности установить дополнительный софт. Проанализировав доступные средства на GitHub нашел несколько реализаций, но они были на мой взгляд, то слишком сложные, то не простые для быстрой интеграции. В общем свой велосипед ближе и милей.</p><p>Класс поддерживает только текст написанный на монотонном фоне, без перемешивания строк.
Такие изображения он не обработает:</p><p><img src=//bpt22.tech/img/ocr/first.png alt=first></p><p><img src=//bpt22.tech/img/ocr/second.png alt=second></p><p>В первом случае из-за разноцветного фона, во втором из-за того что строчки пересекаются. Скрипт разрабатывался для распознавания номеров телефонов на изображении. С чем он и справляется. Для обработки текста изначально он разрезается на строки, слова и символы в словах. Для отделения объектов текста от фона текст выделяется на разнице отличия яркости текста и яркости фона. Как правило фон является доминирующим цветом на изображении, для выявления его соберем все цвета и примем цвет который чаще всего встречается за фон изображения. В изображениях формата JPG частенько встречаются размытия, шумы, для устранения их мы возьмем и удалим все смежные цвета с фоном которые входят в диапазон от цвет фона до цвет фона — 20%. Оставшиеся цвета присвоим тексту. После того как мы определились какого цвета текст, а какого фон мы разделяем изображение на строки. Строки с текстом будут темнее чем меж строчные интервалы, после того как мы вычислим строки, нам нужно нарастить по 20% для захвата букв которые выходят за рамки темной полосы текста. Такие буквы как заглавные и у, р, б и т.д. Так же, для того чтоб подчеркнуть яркость текста мы утолщаем его обходя все изображение и расширяя текст.</p><p><img src=//bpt22.tech/img/ocr/%D0%92%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_001.png alt=img></p><p>Подобный метод разделения на объекты можно применить к словам и буквам, для этого нужно перевернуть изображение на 270 градусов и учесть что между словами интервал больше чем между буквами.</p><p><img src=//bpt22.tech/img/ocr/%D0%92%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_0021.png alt=img>
<img src=//bpt22.tech/img/ocr/%D0%92%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_003.png alt=img></p><p>Разбив текст на буквы приступаем к распознаванию. Для этого нам нужно создать шаблоны для символов. В генераторе шаблонов применяется тот-же алгоритм разделения, но с дополнительным сведением одинаковых символов. Для создания более точных шаблонов необходимо задать погрешность в символах, обычно это до 10%, в этом случае мы выиграем в списке одинаковых символов при создании шаблона. Погрешность задается вызовом метода Recognizer::setInfelicity(10). Чем больше будет образцов для анализа тем лучше. Сам генератор располагается по адресу ./template_generator/generator.php</p><p>После запуска у вас должна появиться форма с изображениями и текстовым полем для ввода расшифровки этого изображения:</p><p><img src=//bpt22.tech/img/ocr/%D0%92%D1%8B%D0%B4%D0%B5%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_004.png alt=img></p><p>Заполнив форму и нажав кнопку Gen вам в браузере выведется шаблон в JSON формате, его нужно сохранить в нужном для вас месте под понятным именем, для подключения его вам нужно задать папку в котором хранится шаблон и его имя с помощью функции Recognizer::setTemplateDir(dirName) Recognizer::loadTemplate(name).</p><p>Каждый символ приводится в формат 15×16 и выглядит в форматированном виде:</p><p><img src=//bpt22.tech/img/ocr/15732349211433010544.6444.png alt=0></p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>000000000000000
</span></span><span style=display:flex><span>000001111000000
</span></span><span style=display:flex><span>000011111100000
</span></span><span style=display:flex><span>000110000111000
</span></span><span style=display:flex><span>001100000011000
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>011100000011100
</span></span><span style=display:flex><span>001100000011000
</span></span><span style=display:flex><span>000110000111000
</span></span><span style=display:flex><span>000111000110000
</span></span><span style=display:flex><span>000011111100000
</span></span></code></pre></div><p><img src=//bpt22.tech/img/ocr/12589651291433010544.6516.png alt=5></p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>000000000000000
</span></span><span style=display:flex><span>001111111110000
</span></span><span style=display:flex><span>011111111110000
</span></span><span style=display:flex><span>011000000000000
</span></span><span style=display:flex><span>011000000000000
</span></span><span style=display:flex><span>011000000000000
</span></span><span style=display:flex><span>011000000000000
</span></span><span style=display:flex><span>011111110000000
</span></span><span style=display:flex><span>011111111000000
</span></span><span style=display:flex><span>000000001110000
</span></span><span style=display:flex><span>000000000110000
</span></span><span style=display:flex><span>000000000110000
</span></span><span style=display:flex><span>000000000110000
</span></span><span style=display:flex><span>011000001110000
</span></span><span style=display:flex><span>011111111100000
</span></span><span style=display:flex><span>001111111000000
</span></span></code></pre></div><p>При сравнении берется значение из шаблона и сравнивается с распознаваемым символом, у того символа который лучше всего совпадет и присваивается значение шаблона, если не удалось распознать, то подставится вопросительный знак.</p><p>Код применения класса:</p><div class=highlight><pre tabindex=0 style=color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>require_once</span> __DIR__ . <span style=color:#0ff;font-weight:700>&#39;/bootstrap.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>use</span> bpteam\phpOCR\Recognizer;
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>use</span> bpteam\phpOCR\Img;
</span></span><span style=display:flex><span>$file_name = __DIR__ . <span style=color:#0ff;font-weight:700>&#39;/template/test_img/olx1.png&#39;</span>;
</span></span><span style=display:flex><span>$ex = <span style=color:#0ff;font-weight:700>&#39;png&#39;</span>;
</span></span><span style=display:flex><span>Recognizer::<span style=color:#007f7f>setInfelicity</span>(<span style=color:#ff0;font-weight:700>10</span>);
</span></span><span style=display:flex><span>$img = Recognizer::<span style=color:#007f7f>openImg</span>($file_name);
</span></span><span style=display:flex><span><span style=color:#007f7f>//Source image
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>echo</span> <span style=color:#0ff;font-weight:700>&#34;&lt;br&gt;Step 0 src img&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>Img::<span style=color:#007f7f>show</span>($img,$ex,<span style=color:#ff0;font-weight:700>100</span>);
</span></span><span style=display:flex><span><span style=color:#007f7f>//load template
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span>$name = <span style=color:#0ff;font-weight:700>&#39;olx&#39;</span>;
</span></span><span style=display:flex><span>Recognizer::<span style=color:#007f7f>setTemplateDir</span>(__DIR__ . <span style=color:#0ff;font-weight:700>&#39;/template/&#39;</span>);
</span></span><span style=display:flex><span>$template = Recognizer::<span style=color:#007f7f>loadTemplate</span>($name);
</span></span><span style=display:flex><span><span style=color:#007f7f>// OCR
</span></span></span><span style=display:flex><span><span style=color:#007f7f></span><span style=color:#fff;font-weight:700>echo</span> <span style=color:#0ff;font-weight:700>&#34;&lt;br&gt;defineImg&lt;br&gt;&#34;</span>;
</span></span><span style=display:flex><span>$text = Recognizer::<span style=color:#007f7f>read</span>($file_name, $template);
</span></span><span style=display:flex><span><span style=color:#fff;font-weight:700>echo</span> $text.<span style=color:#0ff;font-weight:700>&#34;&lt;br&gt;&#34;</span>;
</span></span></code></pre></div><p>Код класса можно форкнуть в моем профиле на <a href=https://github.com/bpteam>GitHub</a> <a href=https://github.com/bpteam/gd2-php-ocr>gd2-php-ocr</a>.</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2022
Evgen Pyanykh
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=//bpt22.tech/js/coder.min.8fb86376a16e684af472a329aef502dbebcfab65ce264e9750d144912947c602.js integrity="sha256-j7hjdqFuaEr0cqMprvUC2+vPq2XOJk6XUNFEkSlHxgI="></script></body></html>